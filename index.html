<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>SUSI Mobile</title>
    <link rel="stylesheet"  href="css/themes/default/jquery.mobile-1.3.2.min.css">
    <link rel="stylesheet"  href="css/calendar.css">
    <link rel="shortcut icon" href="demos/_assets/favicon.ico">
    <script src="js/jquery.js"></script>
    <script src="js/jquery.mobile-1.3.2.min.js"></script>
</head>
<body>
<div data-role="page" id="page1">
    <div data-role="panel" id="defaultpanel" data-position="left" data-display="overlay" data-theme="a" class="ui-panel ui-panel-position-left ui-panel-display-overlay ui-body-a ui-panel-animate ui-panel-open">
        <ul data-role="listview" data-divider-theme="b" data-inset="false">
            <li data-role="list-divider">Меню</li>
            <li data-theme="c">
                <a href="index.html" data-ajax="false">
                    Начало
                </a>
            </li>
            <li data-theme="c">
                <a href="calendar.html" data-ajax="false">
                    Календар
                </a>
            </li>
            <li data-theme="c">
                <a href="contacts.html" data-ajax="false">
                    Контакти
                </a>
            </li>
            <li data-theme="c">
                <a href="showMessages.html" data-ajax="false">
                    Съобщения
                </a>
            </li>
            <li data-theme="c">
                <a href="teachers.html" data-ajax="false">
                    Учители
                </a>
            </li>
        </ul>
    </div>
    <div data-theme="a" data-role="header" data-position="fixed" >
        <a data-role="button" data-icon="search" data-iconpos="notext" data-corners="false"
        class="ui-btn-right" ></a>
        <a data-role="button" href="#defaultpanel" data-icon="bars" data-iconpos="notext" data-corners="false"
        class="ui-btn-left" id="leftPanel" ></a>
        <h3>
            Карта
        </h3>
    </div>
    <div data-role="content">
        <!-- content start -->
        <canvas id="mapcanvas" style="width: 100%; height: 500px; border: 1px solid #000;"></canvas>
        <div id="testDiv" style="min-height:500px;"></div>
		<!-- content end -->
    </div>
</div>
<script src="js/img-touch-canvas.js"></script>
<script type="text/javascript">
//3.921
	selectedPoint = '.';
	var cvs = document.getElementById('mapcanvas');
    var ctx = cvs.getContext("2d");
		ctx.fillStyle="#ff0000";
		ctx.strokeStyle="#ff0000";
	var Pts = [
		/*[23,106],
		[24,48],
		[68,107],
		[69,45],
		[114,106],
		[116,49],
		[162,107],
		[162,51],
		[207,105],
		[208,51],
		[252,110],
		[252,49],
		[321,110],
		[322,180],
		[332,110],
		[331,63],
		[408,110],
		[407,59],
		[467,110],
		[468,57],
		[526,108],
		[525,58],
		[612,102],
		[610,53],
		[686,108],
		[685,56],
		[729,104],
		[731,58],
		[730,164],
		[778,109],
		[779,58],
		[780,168],
		[829,111],
		[829,58],
		[829,170],
		[864,106],
		[864,60],
		[878,107],
		[876,168],
		[924,107],
		[924,60],
		[925,166]*/
/*[73,339],
[76,153],
[217,342],
[220,144],
[364,339],
[371,156],
[518,342],
[518,163],
[662,336],
[665,163],
[806,352],
[806,156],
[1027,352],
[1030,576],
[1062,352],
[1059,201],
[1305,352],
[1302,188],
[1494,352],
[1497,182],
[1683,345],
[1680,185],
[1958,326],
[1952,169],
[2195,345],
[2192,179],
[2332,332],
[2339,185],
[2336,524],
[2489,348],
[2492,185],
[2496,537],
[2652,355],
[2652,185],
[2652,544],
[2764,339],
[2764,192],
[2809,342],
[2803,537],
[2956,342],
[2956,192],
[2960,531]*/
	];
	setTimeout(function(){
		for(i=0;i<Pts.length;i++){
			/*Pts[i][0] = (Pts[i][0]/1000)*cvs.width;
			Pts[i][1] = (Pts[i][1]*cvs.width/1000);*/
			
			//$("#testDiv").append("</br>["+Math.floor(Pts[i][0]*3.2)+","+Math.floor(Pts[i][1]*3.2)+"],");
		}
	},1200);
	function drawLine(A,B){
		ctx.moveTo(A[0],A[1]);
		ctx.lineTo(B[0],B[1]);
	}
	setTimeout(function(){$("#testDiv").append(cvs.width+" "+cvs.height+"</br>");},1200);
	setTimeout(function() {
			var gesturableImg = new ImgTouchCanvas({
				canvas: cvs,
				path: "img/floor3.png",
				customDraw: function(posX,posY,scX,scY){
					/*ctx.moveTo(100,100);
					ctx.lineTo(200,200);*/
					//$("#testDiv").html(posX+" "+posY+" "+scX+" "+scY);
						ctx.fillStyle="#ff0000";
					for(i=0;i<Pts.length;i++){
						ctx.fillRect(Pts[i][0]*scX+posX,Pts[i][1]*scY+posY,10,10);
					}
					
					ctx.fill();
				}
			});
		}, 1000);
	
	$("canvas").click(function(e){
		//alert(e.pageX+" "+e.pageY);
		scale = cvs.width/3200;
		ptX = (e.pageX-$("#mapcanvas").offset().left-5)/scale;
		ptY = (e.pageY-$("#mapcanvas").offset().top-5)/scale;
		Pts[Pts.length] = [ptX,ptY];
		$("#testDiv").append("["+ptX+","+ptY+"]</br>");
		selectedPoint = "["+ptX+","+ptY+"]";
	});
</script>
<script src="js/record_location.js"></script>
</body>
</html>
